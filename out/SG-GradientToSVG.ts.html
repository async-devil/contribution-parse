

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> SG-GradientToSVG.ts</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="GradientToSVGFormat.html">GradientToSVGFormat</a></li><li><a href="Styles.html">Styles</a></li></ul><h3><a href="global.html">Global</a></h3></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>SG-GradientToSVG.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Output of {@link isGradient} method
 * @alias isGradientOutput
 */
type isGradientOutput = {
  /** If gradient detected, result will be true, if not false*/
  result: boolean;
  /** Error message, exists only if gradient hasn`t detected*/
  error?: string;
};

/**
 * Output of {@link regexCut} method
 * @alias regexCutOutput
 */
type regexCutOutput = {
  /** Error message, exists only if gradient is invalid or something went wrong*/
  error?: string;
  /** Result, exist only if error hasn`t appeared*/
  result?: {
    /** Degrees in format like: 50deg*/
    degrees: string;
    /** Gradient ID in format like: id="Gradient"*/
    id: string;
    /** Array of points
     * @example [
            ['#e5afc4', '0%'],
            ['#d782a3', '25%'],
            ['#cd648d', '50%'],
            ['#c44677', '75%'],
            ['#9d325c', '100%'],
          ]
     */
    points: Array&lt;Array&lt;string>>;
  };
};

/**
 * Output of {@link gradientToSVG} method
 * @alias gradientToSVGOutput
 */
type gradientToSVGOutput = {
  /** Error message, exists only if gradient is invalid or something went wrong*/
  error?: string;
  /** Result, exist only if error hasn`t appeared*/
  result?: {
    /** HTML code of SVG gradient */
    html: string;
    /** CSS code of SVG gradient */
    css: string;
  };
};

/**
 * Class which contains methods to analize and transform CSS-like gradients to SVG
 */
class GradientToSVGFormat {
  /**
   * @param {string} info CSS-like gradient
   */
  readonly info;

  constructor(info: string) {
    this.info = info;
  }

  /**
   * @param {string} input CSS-like gradient or random string
   * @returns {isGradientOutput} {@link isGradientOutput}
   */
  public isGradient(input: string): isGradientOutput {
    //^ If input contains rgb(...), returns false
    if (input.search(/rgb\(.*?\)/gm) !== -1) {
      const output: isGradientOutput = { result: false, error: 'Invalid color' };
      return output;
    }

    //^ Getting gradient information in [deg, id, stops] format
    let gradientDataArray = input.replace(/(^l.*?\()|(\)$)/gm, '').split(',');

    //^ If nothing found returns false
    if (gradientDataArray.length === 0) {
      const output: isGradientOutput = { result: false, error: 'Invalid gradient data' };
      return output;
    }

    //^ If number of arguments less than 3 returns false
    if (gradientDataArray.length &lt; 3) {
      const output: isGradientOutput = { result: false, error: 'Invalid gradient data' };
      return output;
    }

    //^ Deleting first space if they are exist
    for (let i = 0; i &lt; gradientDataArray.length; i += 1) {
      gradientDataArray[i] = gradientDataArray[i].replace(/^ /gm, '');
    }

    //^ If number with deg not found then returns false
    if (gradientDataArray[0].search(/^\d{0,3}deg$/gm) === -1) {
      const output: isGradientOutput = { result: false, error: 'Invalid degrees' };
      return output;
    }

    //^ If id not found returns false
    if (gradientDataArray[1].search(/^id=".*"$/gm) === -1) {
      const output: isGradientOutput = { result: false, error: 'Invalid ID' };
      return output;
    }

    //^ Getting color and percentage into an array in array
    let gradientStopsInfo: Array&lt;Array&lt;string>> = [];
    for (let i = 0; i &lt; gradientDataArray.length - 2; i += 1) {
      gradientStopsInfo[i] = gradientDataArray[i + 2].split(' ');
    }

    //^ Grabbing each of stop point properties
    for (let i = 0; i &lt; gradientStopsInfo.length; i += 1) {
      //^ Checking if color is a hex, if not returns false
      if (gradientStopsInfo[i][0].search(/(^#[0-9a-fA-F]{3}$)|(^#[0-9a-fA-F]{6}$)/gm) === -1) {
        const output: isGradientOutput = { result: false, error: 'Invalid color' };
        return output;
      }

      //^ checking if percentage valid, if not returns false
      if (gradientStopsInfo[i][1].search(/^\d*%$/gm) === -1) {
        const output: isGradientOutput = { result: false, error: 'Invalid percentage' };
        return output;
      }
    }

    const output: isGradientOutput = { result: true };
    return output;
  }

  /**
   * Reversed method, transforms SVG-like gradient to CSS
   * @param {regexCutOutput} data Parsed gradient in result object
   * @returns {string} CSS-like gradient
   */
  public parcedGradientInfoToCSS(data: regexCutOutput): string {
    //^ Checking if nothing got wrong
    if (data.error !== undefined || data.result === undefined)
      //^ If incorrect data appears returns this
      return `linear-gradient(green, lightgreen)`;
    const deg = data.result.degrees;

    //^ Getting all points as a string
    let buffer: string[] = [];
    for (let i = 0; i &lt; data.result.points.length; i += 1) {
      buffer.push(`${data.result.points[i][0]} ${data.result.points[i][1]}`);
    }
    const points = buffer.join(', ');

    return `linear-gradient(${deg}, ${points})`;
  }

  /**
   * Transform degrees into SVG XY, but returns only parced degrees like: 0, 45, 90, 135 etc. (n+45)
   * @param {string} deg Degrees in format like: 50deg
   * @returns {string} XY values in format like: x1="100%" y1="0%" x2="100%" y2="0%"
   */
  public degreesToSVGXY(deg: string): string {
    //^ Cutting % and transforming string to integer
    let degInt = parseInt(deg.replace('%', ''));

    //^ Transforms 1 to 45 etc
    const degreesToStandart = (deg: number) => {
      if (deg === 360) return 0;
      for (let index = 0; index != 360; index += 45) {
        if (deg > index &amp;&amp; deg &lt;= index + 45) return index + 45;
      }
      return deg;
    };
    degInt = degreesToStandart(degInt);

    //^ Declaring x and y parametrs composer
    const fill = (x1: number, y1: number, x2: number, y2: number) => {
      return `x1="${x1}%" y1="${y1}%" x2="${x2}%" y2="${y2}%"`;
    };

    //^ Returning coords depending on the degrees
    //TODO: make it less lame, make algorithm or smth
    if (degInt === 0) return fill(0, 100, 0, 0);
    if (degInt === 45) return fill(0, 100, 100, 0);
    if (degInt === 90) return fill(0, 0, 100, 0);
    if (degInt === 135) return fill(0, 0, 100, 100);
    if (degInt === 180) return fill(0, 0, 0, 100);
    if (degInt === 225) return fill(100, 0, 0, 100);
    if (degInt === 270) return fill(100, 0, 0, 0);
    if (degInt === 315) return fill(100, 100, 0, 0);

    return fill(0, 100, 0, 0);
  }

  /**
   * Transforms CSS-like gradient into parced gradient info
   * @param {string} input CSS-like gradient
   * @returns {regexCutOutput} {@link regexCutOutput}
   */
  public regexCut(input: string): regexCutOutput {
    //^ Checking if input is a valid gradient
    const isGradient = this.isGradient(input);
    if (isGradient.result === false) {
      //^ If not returns error description
      let output: regexCutOutput = { error: isGradient.error };
      return output;
    }

    //^ Slicing up input
    let cuttedAndSlicedInput = input.replace(/(^l.*?\()|(\)$)/gm, '').split(',');
    for (let i = 0; i &lt; cuttedAndSlicedInput.length; i += 1) {
      cuttedAndSlicedInput[i] = cuttedAndSlicedInput[i].replace(/^ /gm, '');
    }

    //^ Getting points
    let inputPoints: Array&lt;Array&lt;string>> = [];
    for (let i = 0; i &lt; cuttedAndSlicedInput.length - 2; i += 1) {
      inputPoints[i] = cuttedAndSlicedInput[i + 2].split(' ');
    }

    //^ Composing output
    const output: regexCutOutput = {
      result: {
        degrees: cuttedAndSlicedInput[0],
        id: cuttedAndSlicedInput[1],
        points: inputPoints,
      },
    };
    return output;
  }
  /**
   * Packs parced info from {@link regexCutOutput} into object
   * @returns {gradientToSVGOutput} {@link gradientToSVGOutput}
   */
  public construct(): gradientToSVGOutput {
    //^ Declaring input as parsed info
    const input = this.regexCut(this.info);

    //^ If regexCut returns error than returns error
    if (typeof input.error === 'string') {
      const output: gradientToSVGOutput = { error: input.error };
      return output;
    }

    const result = input.result;

    //^ Declaring SVG stops parameter
    const SVGStop = (percent: string, color: string) => {
      return `&lt;stop offset="${percent}" stop-color="${color}"/>`;
    };

    //^ Declaring html output composer
    const htmlOutput = (id: string, XY: string, SVGStops: string) => {
      return `
      &lt;linearGradient ${id} ${XY}>
      ${SVGStops}
      &lt;/linearGradient>
      `;
    };

    //^ Declaring css output composer
    const cssOutput = (id: string) => {
      const cssId = id.replace(/(^id=)|(")/gm, '');
      return `fill: url(#${cssId})`;
    };

    //^ Declaring SVG stops array
    let buffer: string[] = [];
    //^ Necessary check
    if (result !== undefined) {
      for (let i = 0; i &lt; result.points.length; i += 1) {
        buffer.push(SVGStop(result.points[i][1], result.points[i][0]));
      }
    } else {
      const output: gradientToSVGOutput = {
        error: 'result is undefined',
      };
      return output;
    }
    const SVGStops = buffer.join('\n');

    const output: gradientToSVGOutput = {
      result: {
        html: htmlOutput(result.id, this.degreesToSVGXY(result.degrees), SVGStops),
        css: cssOutput(result.id),
      },
    };

    return output;
  }
}

export { GradientToSVGFormat as default };
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
